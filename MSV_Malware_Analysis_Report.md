# MSI 기반 미탐 악성코드 분석 보고서

## 1. 파일 동작 구조

MSI 파일 실행 시 시스템 내 다음과 같은 프로세스 계층 구조가 생성됩니다:

- **부모 프로세스**: msiexec.exe
- **자식 프로세스**: msiexec.exe (동일 이름)
- **생성 파일**: 임의의 파일명.tmp 형식의 파일 2개

> **참고**: msiexec.exe는 Windows Installer(MSI) 패키지의 설치, 수정 및 제거를 담당하는 정상적인 Windows 시스템 실행 파일입니다.

## 2. 의심 행위 분석

### 2.1 첫 번째 임시 파일 동작

```
"C:\Windows\Installer\MSIF1FF.tmp"/DontWait /HideWindow /dir "C:\Users\admin\AppData\Roaming\TypeFasterPortable"
```

#### 분석 결과:
- 해당 파일은 실제로 임시 파일이 아닌 Windows PE32 형식의 실행 파일입니다.
- `/DontWait` 및 `/HideWindow` 파라미터를 사용하여 사용자에게 표시되지 않는 백그라운드 설치를 시도합니다.
- 설치 디렉토리가 `%AppData%\TypeFasterPortable`로 지정되어 있으며, 이는 일반적인 악성코드가 지속성을 위해 사용하는 경로입니다.
- 정상적인 설치 프로그램으로 가장하고 있지만, 숨겨진 창에서 실행되는 점이 의심스럽습니다.

### 2.2 두 번째 임시 파일 동작

```
"C:\Windows\Installer\MSIF1FF.tmp"" C:\Windows\System32\rundll32.exe "C:\Users\Admin\AppData\Roaming\TypeFasterPortable\meitneriumatm.dll",muirent"
```

#### 분석 결과:
- rundll32.exe를 사용하여 `meitneriumatm.dll` 파일을 로드하고 `muirent` 함수를 호출합니다.
- rundll32.exe는 악성코드가 자주 악용하는 정상 Windows 실행 파일입니다.
- 특정 문자열 처리 루프와 ShellExecuteEx API 호출을 수행하며, 이는 추가 실행 파일 실행을 위한 것으로 추정됩니다.
- 동일한 DLL 실행 명령이 반복적으로 설정되는 것은 실행 성공을 보장하기 위한 의도로 보입니다.

### 2.3 바로가기 파일 생성

- 인터넷 바로가기 파일이 생성되었으며, 해당 바로가기에 다음 경로가 포함되어 있습니다:
  ```
  'C:\Users\Admin\AppData\Roaming\TypeFasterPortable\meitneriumatm.dll",muirent'
  ```
- 바로가기 내 악성 주소가 비활성화된 상태로 보이며, 원래 의도된 추가 기능이 정상 동작하지 않는 것으로 추정됩니다.

## 3. 주요 기능 요약

1. MSI 파일 실행 시 정상적인 Windows 설치 관리자(msiexec.exe)를 통해 악성코드 실행
2. 사용자에게 보이지 않는 숨겨진 창에서 설치 진행
3. %AppData% 경로에 의심스러운 파일 배치로 지속성 확보
4. rundll32.exe를 통한 DLL 사이드로딩 기법 활용
5. 인터넷 바로가기 파일을 통한 추가 실행 경로 확보 시도

## 4. 악성코드 특징 및 예상 동작

이 악성코드가 완전히 기능할 경우 다음과 같은 동작이 예상됩니다:

1. **자기 방어 메커니즘**: 정상적인 Windows 프로세스(msiexec.exe)를 위장하여 탐지 회피
2. **원격 제어 기능**: C&C 서버와 통신하여 명령을 수신하고 시스템 원격 제어
3. **지속성 확보**: %AppData% 폴더 및 바로가기 파일을 통한 시스템 재부팅 후에도 실행 보장
4. **로그 은폐**: 정상적인 설치 오류로 위장하여 악성 활동 감춤
5. **분석 우회**: 보안 도구가 의심하지 않도록 정상적인 시스템 활동으로 위장

## 5. 결론 및 대응 방안

- 해당 악성코드는 **RAT(Remote Access Trojan)** 유형의 특성을 보이며, 파일 기반 탐지 회피 기법을 사용합니다.
- RAT의 핵심 특징인 지속성 확보(영구 실행)와 C2 통신이 확인됩니다.
- 이러한 위협에 대응하기 위해서는 다음이 필요합니다:
  - 파일 기반 탐지보다 행위 기반 분석 강화
  - 의심스러운 프로세스 계층 구조 모니터링
  - 알려진 정상 프로세스(msiexec.exe, rundll32.exe)의 비정상적 사용 감시
  - %AppData% 및 기타 비표준 위치에 설치되는 애플리케이션 제한
  - 추가 보안 제어를 통한 DLL 사이드로딩 방지

> **보안 권장 사항**: 모든 실행 파일에 대한 디지털 서명 확인을 강화하고, 사용자 권한 관리를 철저히 하며, EDR(Endpoint Detection and Response) 솔루션을 통한 행위 기반 모니터링을 구현할 것을 권장합니다.